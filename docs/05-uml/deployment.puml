@startuml Deployment Diagram - OldGoods Marketplace

!define RECTANGLE node

skinparam node {
  BackgroundColor LightBlue
  BorderColor DarkBlue
}

node "Internet" {
}

cloud "Cloud/Server" {
  
  node "Load Balancer\n(Nginx)" as nginx {
    component "Reverse Proxy" as proxy
    component "SSL Termination" as ssl
  }
  
  node "Application Server" as appServer {
    component "Uvicorn\n(ASGI)" as uvicorn
    component "FastAPI Application" as api
  }
  
  node "Database Server" as dbServer {
    database "PostgreSQL" as postgres {
      component "oldgoods_db" as database
    }
  }
  
  node "Cache Server" as cacheServer {
    component "Redis" as redis {
      component "PubSub/Cache\n(Optional)" as channelLayer
    }
  }
  
  node "File Storage" as fileStorage {
    component "Local Storage\n/media/" as localStorage
    component "S3 Storage\n(Optional)" as s3Storage
  }
}

' Connections
Internet --> nginx : "HTTPS (443)\nHTTP (80)"
Internet --> nginx : "WebSocket (WS)"

nginx --> uvicorn : "HTTP+WebSocket (8000)"

uvicorn --> api

api --> postgres : "SQL (5432)"
api --> redis : "Redis Protocol (6379)\n(Optional)"
api --> localStorage : "File I/O"
api --> s3Storage : "S3 API\n(Optional)"

api --> channelLayer

' Notes
note right of nginx
  - Handles SSL/TLS
  - Serves static files
  - Routes to app servers
end note

note right of appServer
  - Uvicorn: HTTP + WebSocket (ASGI)
  - Multiple workers for scaling
end note

note right of dbServer
  - ACID transactions
  - Connection pooling
  - Backup strategy
end note

note right of cacheServer
  - PubSub for multi-instance broadcast (optional)
  - Can be used for caching/rate limit (future)
end note

@enduml
